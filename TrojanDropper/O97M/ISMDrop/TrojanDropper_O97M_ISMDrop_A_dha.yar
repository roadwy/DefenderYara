
rule TrojanDropper_O97M_ISMDrop_A_dha{
	meta:
		description = "TrojanDropper:O97M/ISMDrop.A!dha,SIGNATURE_TYPE_MACROHSTR_EXT,04 00 04 00 0b 00 00 "
		
	strings :
		$a_03_0 = {53 68 65 6c 6c 20 45 6e 76 69 72 6f 6e 24 28 22 43 4f 4d 53 50 45 43 22 29 20 26 20 22 20 2f 63 20 65 63 68 6f 20 70 6f 77 65 72 73 68 65 6c 6c 20 3e 20 22 20 26 20 22 20 22 20 26 20 43 68 72 28 33 34 29 20 26 20 90 02 10 20 26 20 43 68 72 28 33 34 29 2c 20 76 62 48 69 64 65 0d 0a 90 00 } //1
		$a_01_1 = {20 3d 20 22 43 6f 70 79 2d 49 74 65 6d 20 22 20 26 20 43 68 72 28 33 39 29 20 26 20 22 25 46 69 6c 65 50 61 74 68 25 22 20 26 20 43 68 72 28 33 39 29 20 26 20 22 20 22 20 26 20 43 68 72 28 33 39 29 20 26 20 22 25 44 65 73 74 46 6f 6c 64 65 72 25 22 20 26 20 43 68 72 28 33 39 29 0d 0a } //1
		$a_03_2 = {53 68 65 6c 6c 20 45 6e 76 69 72 6f 6e 24 28 22 43 4f 4d 53 50 45 43 22 29 20 26 20 22 20 2f 63 20 22 20 26 20 90 02 10 20 26 20 22 20 22 20 26 20 90 02 10 2c 20 76 62 48 69 64 65 0d 0a 90 00 } //1
		$a_03_3 = {20 3d 20 53 70 6c 69 74 28 90 02 10 2c 20 43 68 72 28 90 02 02 29 20 26 20 43 68 72 28 90 02 02 29 20 26 20 43 68 72 28 90 02 02 29 20 26 20 43 68 72 28 90 02 02 29 20 26 20 43 68 72 28 90 02 02 29 20 26 20 43 68 72 28 90 02 02 29 29 0d 0a 90 00 } //1
		$a_01_4 = {20 3d 20 22 52 65 6d 6f 76 65 2d 49 74 65 6d 20 22 20 26 20 43 68 72 28 33 39 29 20 26 20 22 25 46 69 6c 65 25 22 20 26 20 43 68 72 28 33 39 29 0d 0a } //1
		$a_03_5 = {53 65 74 20 90 02 10 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 22 41 44 4f 44 42 2e 53 74 72 65 61 6d 22 29 0d 0a 90 00 } //1
		$a_01_6 = {20 3d 20 45 6e 76 69 72 6f 6e 24 28 22 41 70 70 44 61 74 61 22 29 20 26 20 22 5c 54 6d 70 2e 64 6f 63 22 0d 0a } //1
		$a_01_7 = {20 3d 20 45 6e 76 69 72 6f 6e 24 28 22 41 70 70 44 61 74 61 22 29 20 26 20 22 5c 42 61 73 65 2e 74 78 74 22 } //1  = Environ$("AppData") & "\Base.txt"
		$a_01_8 = {20 3d 20 45 6e 76 69 72 6f 6e 24 28 22 50 55 42 4c 49 43 22 29 20 26 20 22 5c 4c 69 62 72 61 72 69 65 73 5c 73 65 72 76 69 63 65 72 65 73 65 74 2e 65 78 65 22 } //1  = Environ$("PUBLIC") & "\Libraries\servicereset.exe"
		$a_01_9 = {45 72 72 6f 72 20 77 68 69 6c 65 20 63 6f 6e 76 65 72 74 69 6e 67 20 64 6f 63 75 6d 65 6e 74 2e 20 4e 53 43 6f 63 6f 61 45 72 72 6f 72 44 6f 6d 61 69 6e 20 43 6f 64 65 3d 33 38 34 30 20 55 6e 61 62 6c 65 20 74 6f 20 63 6f 6e 76 65 72 74 20 64 61 74 61 20 74 6f 20 73 74 72 69 6e 67 20 61 72 6f 75 6e 64 20 63 68 61 72 61 63 74 65 72 20 33 34 } //1 Error while converting document. NSCocoaErrorDomain Code=3840 Unable to convert data to string around character 34
		$a_03_10 = {20 3d 20 22 24 44 41 54 41 20 3d 20 5b 53 79 73 74 65 6d 2e 43 6f 6e 76 65 72 74 5d 3a 3a 46 72 6f 6d 42 61 73 65 36 34 53 74 72 69 6e 67 28 5b 49 4f 2e 46 69 6c 65 5d 3a 3a 52 65 61 64 41 6c 6c 54 65 78 74 28 27 25 42 61 73 65 25 27 29 29 3b 5b 69 6f 2e 66 69 6c 65 5d 3a 3a 57 72 69 74 65 41 6c 6c 42 79 74 65 73 28 27 90 02 10 27 2c 24 44 41 54 41 29 3b 53 74 61 72 74 2d 50 72 6f 63 65 73 73 20 27 90 02 10 27 22 0d 0a 90 00 } //2
	condition:
		((#a_03_0  & 1)*1+(#a_01_1  & 1)*1+(#a_03_2  & 1)*1+(#a_03_3  & 1)*1+(#a_01_4  & 1)*1+(#a_03_5  & 1)*1+(#a_01_6  & 1)*1+(#a_01_7  & 1)*1+(#a_01_8  & 1)*1+(#a_01_9  & 1)*1+(#a_03_10  & 1)*2) >=4
 
}