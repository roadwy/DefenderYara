
rule Trojan_O97M_Emotet_CS_eml{
	meta:
		description = "Trojan:O97M/Emotet.CS!eml,SIGNATURE_TYPE_MACROHSTR_EXT,05 00 05 00 05 00 00 "
		
	strings :
		$a_01_0 = {2a 73 33 3d 37 37 36 39 36 65 36 64 36 37 36 64 37 34 37 33 33 61 35 37 36 39 36 65 33 33 33 32 35 66 35 30 37 32 36 66 36 33 36 35 37 33 37 33 35 33 37 34 36 31 37 32 37 34 37 35 37 30 } //1 *s3=77696e6d676d74733a57696e33325f50726f6365737353746172747570
		$a_01_1 = {43 61 6c 6c 20 41 74 28 56 45 43 2c 20 73 48 65 78 44 65 63 6f 64 65 28 63 6f 6c 56 61 72 69 61 62 69 6c 69 28 22 73 33 22 29 29 2c 20 73 48 65 78 44 65 63 6f 64 65 28 63 6f 6c 56 61 72 69 61 62 69 6c 69 28 22 73 34 22 29 29 29 } //1 Call At(VEC, sHexDecode(colVariabili("s3")), sHexDecode(colVariabili("s4")))
		$a_01_2 = {53 65 74 20 6f 50 72 6f 63 65 73 73 20 3d 20 43 72 65 61 74 65 4f 62 6a 65 63 74 28 67 65 29 } //1 Set oProcess = CreateObject(ge)
		$a_01_3 = {3d 20 6f 50 72 6f 63 65 73 73 2e 45 78 65 63 4d 65 74 68 6f 64 5f 28 73 48 65 78 44 65 63 6f 64 65 28 22 34 33 37 32 36 35 36 31 37 34 36 35 22 29 } //1 = oProcess.ExecMethod_(sHexDecode("437265617465")
		$a_03_4 = {3d 20 72 65 70 28 56 45 43 2c 20 22 90 02 06 22 2c 20 22 68 74 74 70 22 29 90 00 } //1
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_03_4  & 1)*1) >=5
 
}