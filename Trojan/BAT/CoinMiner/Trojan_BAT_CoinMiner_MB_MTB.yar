
rule Trojan_BAT_CoinMiner_MB_MTB{
	meta:
		description = "Trojan:BAT/CoinMiner.MB!MTB,SIGNATURE_TYPE_PEHSTR_EXT,09 00 09 00 09 00 00 "
		
	strings :
		$a_03_0 = {07 06 1f 10 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 20 ?? ?? ?? ?? 2b 00 28 ?? ?? ?? 2b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 2b 24 07 06 1f 10 6f ?? ?? ?? 0a 28 ?? ?? ?? 0a 20 ?? ?? ?? ?? 2b 00 28 ?? ?? ?? 2b 6f ?? ?? ?? 0a 6f ?? ?? ?? 0a 0c 20 ?? ?? ?? ?? 38 ?? ff ff ff } //1
		$a_03_1 = {61 25 13 07 19 5e 45 03 00 00 00 df ff ff ff 02 00 00 00 19 00 00 00 2b 17 11 04 6f ?? ?? ?? 0a 11 07 20 ?? ?? ?? ?? 5a 20 ?? ?? ?? ?? 61 2b cb } //1
		$a_01_2 = {52 65 73 75 6d 65 54 68 72 65 61 64 } //1 ResumeThread
		$a_01_3 = {56 69 72 74 75 61 6c 41 6c 6c 6f 63 45 78 } //1 VirtualAllocEx
		$a_01_4 = {55 6e 6d 61 70 56 69 65 77 4f 66 53 65 63 74 69 6f 6e } //1 UnmapViewOfSection
		$a_01_5 = {57 72 69 74 65 50 72 6f 63 65 73 73 4d 65 6d 6f 72 79 } //1 WriteProcessMemory
		$a_01_6 = {4b 69 6c 6c } //1 Kill
		$a_01_7 = {43 72 65 61 74 65 45 6e 63 72 79 70 74 6f 72 } //1 CreateEncryptor
		$a_01_8 = {43 72 65 61 74 65 44 65 63 72 79 70 74 6f 72 } //1 CreateDecryptor
	condition:
		((#a_03_0  & 1)*1+(#a_03_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1+(#a_01_6  & 1)*1+(#a_01_7  & 1)*1+(#a_01_8  & 1)*1) >=9
 
}
rule Trojan_BAT_CoinMiner_MB_MTB_2{
	meta:
		description = "Trojan:BAT/CoinMiner.MB!MTB,SIGNATURE_TYPE_PEHSTR_EXT,0c 00 0c 00 06 00 00 "
		
	strings :
		$a_81_0 = {68 74 74 70 3a 2f 2f 31 38 35 2e 31 37 32 2e 31 32 38 2e 31 31 } //5 http://185.172.128.11
		$a_01_1 = {2f 00 63 00 20 00 73 00 63 00 68 00 74 00 61 00 73 00 6b 00 73 00 20 00 2f 00 63 00 72 00 65 00 61 00 74 00 65 00 20 00 2f 00 66 00 20 00 2f 00 73 00 63 00 20 00 4d 00 49 00 4e 00 55 00 54 00 45 00 20 00 2f 00 6d 00 6f 00 20 00 33 00 20 00 2f 00 52 00 4c 00 20 00 48 00 49 00 47 00 48 00 45 00 53 00 54 00 20 00 2f 00 74 00 6e 00 } //3 /c schtasks /create /f /sc MINUTE /mo 3 /RL HIGHEST /tn
		$a_01_2 = {2f 00 63 00 72 00 65 00 61 00 74 00 65 00 20 00 2f 00 73 00 63 00 20 00 4d 00 49 00 4e 00 55 00 54 00 45 00 20 00 2f 00 6d 00 6f 00 20 00 33 00 20 00 2f 00 74 00 6e 00 } //1 /create /sc MINUTE /mo 3 /tn
		$a_01_3 = {2f 00 7a 00 69 00 6d 00 61 00 2e 00 70 00 68 00 70 00 3f 00 6d 00 69 00 6e 00 65 00 3d 00 58 00 4d 00 52 00 } //1 /zima.php?mine=XMR
		$a_01_4 = {40 00 65 00 63 00 68 00 6f 00 20 00 6f 00 66 00 66 00 } //1 @echo off
		$a_01_5 = {74 00 69 00 6d 00 65 00 6f 00 75 00 74 00 20 00 33 00 20 00 3e 00 20 00 4e 00 55 00 4c 00 } //1 timeout 3 > NUL
	condition:
		((#a_81_0  & 1)*5+(#a_01_1  & 1)*3+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1) >=12
 
}