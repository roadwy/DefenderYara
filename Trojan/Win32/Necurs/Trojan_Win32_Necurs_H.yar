
rule Trojan_Win32_Necurs_H{
	meta:
		description = "Trojan:Win32/Necurs.H,SIGNATURE_TYPE_PEHSTR_EXT,08 00 08 00 16 00 00 "
		
	strings :
		$a_03_0 = {35 de c0 ad de 89 45 ?? ff 15 ?? ?? ?? ?? 33 45 } //2
		$a_03_1 = {8b 45 08 0b 45 0c 0f 31 74 ?? 89 45 ?? 35 ?? ?? ?? ?? c1 c0 0b 89 45 } //1
		$a_03_2 = {51 83 c0 30 35 ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 89 45 f4 89 55 f8 eb 0a } //1
		$a_03_3 = {8b 43 28 03 45 ?? 33 c9 41 89 4d ?? ff 75 18 51 ff 75 ?? ff d0 } //1
		$a_03_4 = {74 6a 69 6e c7 45 ?? 6a 70 74 77 } //1
		$a_03_5 = {63 78 63 63 c7 45 ?? 74 76 62 7a } //1
		$a_03_6 = {78 78 78 70 c7 45 ?? 72 6f 62 69 } //1
		$a_03_7 = {83 f8 04 76 ?? 66 83 bc ?? ?? ff ff ff 74 75 ?? 66 83 bc ?? ?? ff ff ff 69 75 ?? 66 83 bc ?? ?? ff ff ff 62 75 ?? 66 83 bc ?? ?? ff ff ff 2e } //2
		$a_03_8 = {69 c0 e8 03 00 00 83 c4 10 50 ff 15 ?? ?? ?? ?? e8 ?? ?? ?? ?? ff d3 } //1
		$a_80_9 = {2e 5c 4e 74 53 65 63 75 72 65 53 79 73 } //.\NtSecureSys  1
		$a_80_10 = {2e 5c 50 43 49 23 56 45 4e 5f 32 35 41 46 26 44 45 56 5f 30 32 30 39 26 53 55 42 53 59 53 5f 30 37 30 34 35 35 41 46 26 52 45 56 5f 30 30 } //.\PCI#VEN_25AF&DEV_0209&SUBSYS_070455AF&REV_00  1
		$a_80_11 = {2d 73 65 74 20 54 45 53 54 53 49 47 4e 49 4e 47 20 4f 4e } //-set TESTSIGNING ON  1
		$a_80_12 = {2f 43 20 64 65 6c 20 2f 51 20 2f 46 20 22 25 73 22 } ///C del /Q /F "%s"  1
		$a_80_13 = {61 64 76 66 69 72 65 77 61 6c 6c 20 66 69 72 65 77 61 6c 6c 20 73 65 74 20 72 75 6c 65 20 6e 61 6d 65 3d 22 25 73 22 20 64 69 72 3d 25 73 } //advfirewall firewall set rule name="%s" dir=%s  1
		$a_80_14 = {66 69 72 65 77 61 6c 6c 20 73 65 74 20 6f 70 6d 6f 64 65 20 6d 6f 64 65 3d 44 49 53 41 42 4c 45 20 70 72 6f 66 69 6c 65 3d 41 4c 4c } //firewall set opmode mode=DISABLE profile=ALL  1
		$a_80_15 = {25 73 5c 64 72 69 76 65 72 73 5c 25 73 2e 73 79 73 } //%s\drivers\%s.sys  1
		$a_80_16 = {00 66 69 6e 64 6d 65 } //  1
		$a_80_17 = {00 65 69 6e 69 74 } //  1
		$a_80_18 = {00 64 65 6c 6d 65 } //  1
		$a_80_19 = {25 73 25 30 38 78 2d 25 30 34 78 2d 25 30 34 78 2d 25 30 34 78 2d 25 30 38 78 25 30 34 78 2e 74 6d 70 } //%s%08x-%04x-%04x-%04x-%08x%04x.tmp  1
		$a_80_20 = {25 73 25 30 2e 38 58 2d 25 30 2e 34 58 2d 25 30 2e 34 58 2d 25 30 2e 34 58 2d 25 30 2e 38 58 25 30 2e 34 58 7d 5c } //%s%0.8X-%0.4X-%0.4X-%0.4X-%0.8X%0.4X}\  1
		$a_80_21 = {25 30 38 78 20 25 73 77 68 65 6e 20 25 73 20 61 74 20 25 70 } //%08x %swhen %s at %p  1
	condition:
		((#a_03_0  & 1)*2+(#a_03_1  & 1)*1+(#a_03_2  & 1)*1+(#a_03_3  & 1)*1+(#a_03_4  & 1)*1+(#a_03_5  & 1)*1+(#a_03_6  & 1)*1+(#a_03_7  & 1)*2+(#a_03_8  & 1)*1+(#a_80_9  & 1)*1+(#a_80_10  & 1)*1+(#a_80_11  & 1)*1+(#a_80_12  & 1)*1+(#a_80_13  & 1)*1+(#a_80_14  & 1)*1+(#a_80_15  & 1)*1+(#a_80_16  & 1)*1+(#a_80_17  & 1)*1+(#a_80_18  & 1)*1+(#a_80_19  & 1)*1+(#a_80_20  & 1)*1+(#a_80_21  & 1)*1) >=8
 
}