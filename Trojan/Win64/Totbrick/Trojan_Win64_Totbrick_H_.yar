
rule Trojan_Win64_Totbrick_H_{
	meta:
		description = "Trojan:Win64/Totbrick.H!!Totbrick.gen!A,SIGNATURE_TYPE_ARHSTR_EXT,0a 00 0a 00 47 00 00 "
		
	strings :
		$a_03_0 = {48 b9 66 c7 44 24 90 01 01 48 b8 66 c7 44 24 90 01 01 ff e0 4c 89 74 24 90 01 01 4c 89 6c 24 90 01 01 48 c7 44 24 90 01 01 16 00 00 00 90 00 } //1
		$a_01_1 = {c7 07 5a 49 50 41 } //1
		$a_03_2 = {6d 63 63 6f 90 09 03 00 81 7d 90 00 } //1
		$a_03_3 = {76 65 72 00 90 09 03 00 81 7d 90 00 } //1
		$a_03_4 = {67 74 61 67 90 09 03 00 81 7d 90 00 } //1
		$a_03_5 = {73 65 72 76 90 09 03 00 81 7d 90 00 } //1
		$a_03_6 = {61 75 74 6f 90 09 03 00 81 7d 90 00 } //1
		$a_03_7 = {72 75 6e 00 90 09 03 00 81 7d 90 00 } //1
		$a_01_8 = {41 81 3e 73 00 54 00 75 17 41 81 7e 04 61 00 72 00 } //1
		$a_01_9 = {41 81 3e 73 00 74 00 75 11 41 81 7e 04 41 00 72 00 } //1
		$a_03_10 = {32 c2 ff cb 88 45 90 01 01 85 db 7e 90 00 } //1
		$a_01_11 = {4c 8d 44 1b fc 66 41 83 3c 10 33 75 08 66 83 7c 5a fe 32 74 10 66 41 83 3c 10 36 75 1b 66 83 7c 5a fe 34 } //1
		$a_03_12 = {08 02 00 00 c7 45 90 01 01 10 66 00 00 90 00 } //1
		$a_00_13 = {5c 5c 2e 5c 70 69 70 65 5c 70 69 64 70 6c 61 63 65 73 6f 6d 65 70 69 70 65 } //1 \\.\pipe\pidplacesomepipe
		$a_00_14 = {5c 52 65 6c 65 61 73 65 5c 47 65 74 53 79 73 74 65 6d 49 6e 66 6f 2e 70 64 62 } //1 \Release\GetSystemInfo.pdb
		$a_00_15 = {3c 6d 6f 64 75 6c 65 63 6f 6e 66 69 67 3e } //1 <moduleconfig>
		$a_00_16 = {3c 61 75 74 6f 73 74 61 72 74 3e 6e 6f 3c 2f 61 75 74 6f 73 74 61 72 74 3e } //1 <autostart>no</autostart>
		$a_00_17 = {3c 61 75 74 6f 73 74 61 72 74 3e 79 65 73 3c 2f 61 75 74 6f 73 74 61 72 74 3e } //1 <autostart>yes</autostart>
		$a_00_18 = {3c 73 79 73 74 65 6d 69 6e 66 6f 3e 0d 0a 3c 67 65 6e 65 72 61 6c 3e 0d 0a 3c 6f 73 3e 4d 69 63 72 6f 73 6f 66 74 } //1
		$a_00_19 = {47 42 3c 2f 72 61 6d 3e 0d 0a 3c 2f 67 65 6e 65 72 61 6c 3e 0d 0a 3c 75 73 65 72 73 3e 0d 0a 3c 75 73 65 72 3e } //1
		$a_00_20 = {3c 6e 65 65 64 69 6e 66 6f 20 6e 61 6d 65 3d 22 69 64 22 2f 3e } //1 <needinfo name="id"/>
		$a_00_21 = {3c 6e 65 65 64 69 6e 66 6f 20 6e 61 6d 65 3d 22 69 70 22 2f 3e } //1 <needinfo name="ip"/>
		$a_00_22 = {3c 63 6f 6e 66 20 63 74 6c 3d 22 64 69 6e 6a 22 20 66 69 6c 65 3d 22 64 69 6e 6a 22 20 70 65 72 69 6f 64 3d 22 32 30 22 2f 3e } //1 <conf ctl="dinj" file="dinj" period="20"/>
		$a_00_23 = {3c 63 6f 6e 66 20 63 74 6c 3d 22 73 69 6e 6a 22 20 66 69 6c 65 3d 22 73 69 6e 6a 22 20 70 65 72 69 6f 64 3d 22 32 30 22 2f 3e } //1 <conf ctl="sinj" file="sinj" period="20"/>
		$a_00_24 = {3c 63 6f 6e 66 20 63 74 6c 3d 22 64 70 6f 73 74 22 20 66 69 6c 65 3d 22 64 70 6f 73 74 22 20 70 65 72 69 6f 64 3d 22 36 30 22 2f 3e } //1 <conf ctl="dpost" file="dpost" period="60"/>
		$a_00_25 = {3c 63 6f 6e 66 20 63 74 6c 3d 22 53 65 74 43 6f 6e 66 22 20 66 69 6c 65 3d 22 6d 61 69 6c 63 6f 6e 66 22 20 70 65 72 69 6f 64 3d 22 39 30 22 2f 3e } //1 <conf ctl="SetConf" file="mailconf" period="90"/>
		$a_00_26 = {2d 2d 25 53 0d 0a 43 6f 6e 74 65 6e 74 2d 44 69 73 70 6f 73 69 74 69 6f 6e 3a 20 66 6f 72 6d 2d 64 61 74 61 3b 20 6e 61 6d 65 3d 22 6c 69 73 74 22 } //1
		$a_00_27 = {73 2d 6e 67 20 61 6c 72 65 61 64 79 20 72 75 6e 6e 69 6e 67 } //1 s-ng already running
		$a_00_28 = {73 2d 6e 67 20 69 73 20 6e 6f 74 20 72 75 6e 6e 69 6e 67 } //1 s-ng is not running
		$a_00_29 = {63 6c 69 65 6e 74 5f 69 64 20 65 72 72 6f 72 } //1 client_id error
		$a_00_30 = {63 6c 69 65 6e 74 20 69 70 20 61 64 64 72 65 73 73 20 65 72 72 6f 72 } //1 client ip address error
		$a_00_31 = {43 6f 6e 74 72 6f 6c 00 46 72 65 65 42 75 66 66 65 72 00 52 65 6c 65 61 73 65 00 53 74 61 72 74 00 } //2
		$a_00_32 = {25 53 7c 25 53 7c 25 53 } //1 %S|%S|%S
		$a_00_33 = {43 68 72 6f 6d 65 20 68 69 73 74 6f 72 79 20 64 62 20 63 6f 70 } //1 Chrome history db cop
		$a_00_34 = {43 68 72 6f 6d 65 20 68 69 73 74 6f 72 79 20 64 62 20 73 68 6f 75 6c 64 20 62 65 20 63 6f 70 69 65 64 } //1 Chrome history db should be copied
		$a_00_35 = {43 68 72 6f 6d 65 20 6c 6f 67 69 6e 20 64 62 20 63 6f 70 } //1 Chrome login db cop
		$a_00_36 = {43 68 72 6f 6d 65 20 6c 6f 67 69 6e 20 64 62 20 73 68 6f 75 6c 64 20 62 65 20 63 6f 70 69 65 64 } //1 Chrome login db should be copied
		$a_00_37 = {53 6b 69 70 20 43 68 72 6f 6d 65 20 6c 6f 67 69 6e 20 64 62 20 63 6f 70 79 } //1 Skip Chrome login db copy
		$a_00_38 = {53 6b 69 70 20 43 68 72 6f 6d 65 20 68 69 73 74 6f 72 79 20 64 62 20 63 6f 70 79 } //1 Skip Chrome history db copy
		$a_80_39 = {00 73 79 73 74 65 6d 69 6e 66 6f 00 } //  1
		$a_80_40 = {00 69 6e 6a 65 63 74 44 6c 6c 00 } //  1
		$a_80_41 = {2f 73 65 72 30 34 31 37 2f } ///ser0417/  1
		$a_80_42 = {2f 35 2f 73 69 6e 6a 2f } ///5/sinj/  1
		$a_80_43 = {2f 69 6e 6a 65 63 74 44 6c 6c 2f 56 45 52 53 2f 62 72 6f 77 73 65 72 2f } ///injectDll/VERS/browser/  1
		$a_80_44 = {25 73 2f 25 73 2f 25 73 2f 73 65 6e 64 2f } //%s/%s/%s/send/  1
		$a_00_45 = {53 65 72 76 65 72 00 52 65 74 72 79 2d 41 66 74 65 72 00 50 72 6f 78 79 2d 53 75 70 70 6f 72 74 00 50 72 6f 78 79 2d 41 75 74 68 65 6e 74 69 63 61 74 65 } //1
		$a_00_46 = {55 73 65 72 2d 41 67 65 6e 74 3a 20 4d 6f 7a 69 6c 6c 61 2f 35 2e 30 20 28 57 69 6e 64 6f 77 73 20 4e 54 20 31 30 2e 30 3b 20 57 4f 57 36 34 3b 20 72 76 3a 36 30 2e 30 29 20 47 65 63 6b 6f 2f 32 30 31 30 30 31 30 31 20 46 69 72 65 66 6f 78 2f 36 30 2e 30 } //1 User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:60.0) Gecko/20100101 Firefox/60.0
		$a_00_47 = {43 6f 6e 74 65 6e 74 2d 54 79 70 65 3a 20 6d 75 6c 74 69 70 61 72 74 2f 66 6f 72 6d 2d 64 61 74 61 3b 20 62 6f 75 6e 64 61 72 79 3d 2d 2d 2d 2d 2d 2d 42 6f 75 6e 64 61 72 79 30 30 32 37 } //1 Content-Type: multipart/form-data; boundary=------Boundary0027
		$a_80_48 = {5f 63 6f 6e 66 69 67 73 5c 64 69 6e 6a } //_configs\dinj  1
		$a_80_49 = {5f 63 6f 6e 66 69 67 73 5c 73 69 6e 6a } //_configs\sinj  1
		$a_80_50 = {5f 63 6f 6e 66 69 67 73 5c 64 70 6f 73 74 } //_configs\dpost  1
		$a_80_51 = {5f 63 6f 6e 66 69 67 73 5c 6d 61 69 6c 63 6f 6e 66 } //_configs\mailconf  1
		$a_80_52 = {5c 4d 6f 64 75 6c 65 73 5c 73 79 73 74 65 6d 69 6e 66 6f } //\Modules\systeminfo  1
		$a_80_53 = {5c 4d 6f 64 75 6c 65 73 5c 69 6e 6a 65 63 74 44 6c 6c } //\Modules\injectDll  1
		$a_80_54 = {5c 4d 6f 64 75 6c 65 73 5c 6d 61 69 6c 73 65 61 72 63 68 65 72 } //\Modules\mailsearcher  1
		$a_80_55 = {5c 4d 6f 64 75 6c 65 73 5c 69 6d 70 6f 72 74 64 6c 6c } //\Modules\importdll  1
		$a_80_56 = {5c 4d 6f 64 75 6c 65 73 5c 73 68 61 72 65 64 6c 6c } //\Modules\sharedll  1
		$a_80_57 = {5c 4d 6f 64 75 6c 65 73 5c 74 61 62 64 6c 6c } //\Modules\tabdll  1
		$a_80_58 = {5c 4d 6f 64 75 6c 65 73 5c 77 6f 72 6d 64 6c 6c } //\Modules\wormdll  1
		$a_80_59 = {5c 4d 6f 64 75 6c 65 73 5c 6d 6f 64 73 79 73 74 65 6d 69 6e 66 6f } //\Modules\modsysteminfo  1
		$a_00_60 = {3c 73 79 73 74 65 6d 69 6e 66 6f 3e 0d 0a 25 73 25 73 25 73 25 73 3c 2f 73 79 73 74 65 6d 69 6e 66 6f 3e } //1
		$a_00_61 = {3c 67 65 6e 65 72 61 6c 3e 0d 0a 25 73 25 73 25 73 3c 2f 67 65 6e 65 72 61 6c 3e } //1
		$a_00_62 = {3c 6f 73 3e 25 73 20 25 73 20 25 73 3c 2f 6f 73 3e } //1 <os>%s %s %s</os>
		$a_01_63 = {68 44 65 2b 62 5a 38 49 59 74 35 64 } //1 hDe+bZ8IYt5d
		$a_01_64 = {72 47 5a 2b 4a 62 39 46 6c 4f 41 72 } //1 rGZ+Jb9FlOAr
		$a_01_65 = {6c 38 4f 4b 45 2f 6c 39 59 38 6f 48 } //1 l8OKE/l9Y8oH
		$a_01_66 = {6e 2f 61 6b 6f 70 39 30 64 70 43 75 } //1 n/akop90dpCu
		$a_01_67 = {6e 2f 41 4e 6f 53 33 50 59 38 39 36 } //1 n/ANoS3PY896
		$a_01_68 = {74 4f 55 37 74 53 50 37 74 53 6c 47 } //1 tOU7tSP7tSlG
		$a_01_69 = {4f 31 74 4e 79 38 4f 6d 34 70 61 4b } //1 O1tNy8Om4paK
		$a_01_70 = {72 53 61 2f 6f 47 6f 4e 45 38 4f 56 } //1 rSa/oGoNE8OV
	condition:
		((#a_03_0  & 1)*1+(#a_01_1  & 1)*1+(#a_03_2  & 1)*1+(#a_03_3  & 1)*1+(#a_03_4  & 1)*1+(#a_03_5  & 1)*1+(#a_03_6  & 1)*1+(#a_03_7  & 1)*1+(#a_01_8  & 1)*1+(#a_01_9  & 1)*1+(#a_03_10  & 1)*1+(#a_01_11  & 1)*1+(#a_03_12  & 1)*1+(#a_00_13  & 1)*1+(#a_00_14  & 1)*1+(#a_00_15  & 1)*1+(#a_00_16  & 1)*1+(#a_00_17  & 1)*1+(#a_00_18  & 1)*1+(#a_00_19  & 1)*1+(#a_00_20  & 1)*1+(#a_00_21  & 1)*1+(#a_00_22  & 1)*1+(#a_00_23  & 1)*1+(#a_00_24  & 1)*1+(#a_00_25  & 1)*1+(#a_00_26  & 1)*1+(#a_00_27  & 1)*1+(#a_00_28  & 1)*1+(#a_00_29  & 1)*1+(#a_00_30  & 1)*1+(#a_00_31  & 1)*2+(#a_00_32  & 1)*1+(#a_00_33  & 1)*1+(#a_00_34  & 1)*1+(#a_00_35  & 1)*1+(#a_00_36  & 1)*1+(#a_00_37  & 1)*1+(#a_00_38  & 1)*1+(#a_80_39  & 1)*1+(#a_80_40  & 1)*1+(#a_80_41  & 1)*1+(#a_80_42  & 1)*1+(#a_80_43  & 1)*1+(#a_80_44  & 1)*1+(#a_00_45  & 1)*1+(#a_00_46  & 1)*1+(#a_00_47  & 1)*1+(#a_80_48  & 1)*1+(#a_80_49  & 1)*1+(#a_80_50  & 1)*1+(#a_80_51  & 1)*1+(#a_80_52  & 1)*1+(#a_80_53  & 1)*1+(#a_80_54  & 1)*1+(#a_80_55  & 1)*1+(#a_80_56  & 1)*1+(#a_80_57  & 1)*1+(#a_80_58  & 1)*1+(#a_80_59  & 1)*1+(#a_00_60  & 1)*1+(#a_00_61  & 1)*1+(#a_00_62  & 1)*1+(#a_01_63  & 1)*1+(#a_01_64  & 1)*1+(#a_01_65  & 1)*1+(#a_01_66  & 1)*1+(#a_01_67  & 1)*1+(#a_01_68  & 1)*1+(#a_01_69  & 1)*1+(#a_01_70  & 1)*1) >=10
 
}