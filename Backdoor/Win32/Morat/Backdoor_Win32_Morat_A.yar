
rule Backdoor_Win32_Morat_A{
	meta:
		description = "Backdoor:Win32/Morat.A,SIGNATURE_TYPE_PEHSTR_EXT,04 00 03 00 04 00 00 "
		
	strings :
		$a_00_0 = {2f 00 75 00 2e 00 70 00 68 00 70 00 3f 00 76 00 65 00 72 00 3d 00 25 00 73 00 26 00 6d 00 69 00 64 00 3d 00 25 00 73 00 } //1 /u.php?ver=%s&mid=%s
		$a_00_1 = {77 00 69 00 64 00 65 00 5f 00 73 00 65 00 61 00 72 00 63 00 68 00 5f 00 63 00 6c 00 6f 00 73 00 65 00 5f 00 6d 00 65 00 73 00 73 00 61 00 67 00 65 00 } //1 wide_search_close_message
		$a_00_2 = {70 00 69 00 6e 00 67 00 20 00 2d 00 6e 00 20 00 31 00 30 00 20 00 31 00 32 00 37 00 2e 00 30 00 2e 00 30 00 2e 00 31 00 20 00 3e 00 20 00 4e 00 55 00 4c 00 } //1 ping -n 10 127.0.0.1 > NUL
		$a_03_3 = {68 e8 03 00 00 e8 ?? ?? ?? ?? 33 c9 b2 01 a1 ?? ?? ?? ?? e8 ?? ?? ?? ?? 89 45 ?? 8b 45 ?? c6 80 40 01 00 00 01 8d 45 ?? 50 66 c7 45 ?? 32 00 c6 45 ?? 09 a1 ?? ?? ?? ?? 89 45 ?? c6 45 ?? 11 8d 55 ?? b9 01 00 00 00 b8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b 55 ?? 8b 4d ?? 8b 45 ?? e8 ?? ?? ?? ?? ff 35 ?? ?? ?? ?? 68 ?? ?? ?? ?? 68 ?? ?? ?? ?? 8d 45 ?? ba 03 00 00 00 e8 } //1
	condition:
		((#a_00_0  & 1)*1+(#a_00_1  & 1)*1+(#a_00_2  & 1)*1+(#a_03_3  & 1)*1) >=3
 
}