
rule Exploit_MacOS_LimeRain_C_MTB{
	meta:
		description = "Exploit:MacOS/LimeRain.C!MTB,SIGNATURE_TYPE_MACHOHSTR_EXT,04 00 04 00 04 00 00 "
		
	strings :
		$a_00_0 = {69 73 66 69 72 6d 77 61 72 65 70 61 79 6c 6f 61 64 } //1 isfirmwarepayload
		$a_00_1 = {53 65 6e 64 69 6e 67 20 66 61 6b 65 20 64 61 74 61 } //1 Sending fake data
		$a_00_2 = {6c 69 6d 65 72 61 31 6e 5f 65 78 70 6c 6f 69 74 } //1 limera1n_exploit
		$a_00_3 = {45 78 70 6c 6f 69 74 20 73 65 6e 74 } //1 Exploit sent
	condition:
		((#a_00_0  & 1)*1+(#a_00_1  & 1)*1+(#a_00_2  & 1)*1+(#a_00_3  & 1)*1) >=4
 
}
rule Exploit_MacOS_LimeRain_C_MTB_2{
	meta:
		description = "Exploit:MacOS/LimeRain.C!MTB,SIGNATURE_TYPE_MACHOHSTR_EXT,03 00 03 00 04 00 00 "
		
	strings :
		$a_00_0 = {69 6f 6b 69 74 5f 6c 69 6d 65 72 61 31 6e 5f 75 73 62 5f 73 75 62 6d 69 74 5f 72 65 71 75 65 73 74 } //1 iokit_limera1n_usb_submit_request
		$a_00_1 = {69 72 65 63 76 5f 74 72 69 67 67 65 72 5f 6c 69 6d 65 72 61 31 6e 5f 65 78 70 6c 6f 69 74 } //1 irecv_trigger_limera1n_exploit
		$a_03_2 = {48 89 df 4c 89 f6 e8 30 00 00 00 48 8b ?? ?? 00 00 00 48 85 c0 74 17 48 8d 75 c8 44 89 3e 4c 89 76 08 c7 46 18 03 00 00 00 48 89 df ff d0 } //1
		$a_03_3 = {80 38 23 74 1b 4c 89 ff 48 89 c6 e8 ?? ?? ff ff 85 c0 75 ?? 4c 89 ff e8 ?? ?? ff ff 85 c0 75 ?? 31 db 31 ff 4c 89 e6 e8 ?? ?? 00 00 48 85 c0 75 ?? eb 06 } //1
	condition:
		((#a_00_0  & 1)*1+(#a_00_1  & 1)*1+(#a_03_2  & 1)*1+(#a_03_3  & 1)*1) >=3
 
}