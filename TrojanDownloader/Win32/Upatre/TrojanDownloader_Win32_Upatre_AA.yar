
rule TrojanDownloader_Win32_Upatre_AA{
	meta:
		description = "TrojanDownloader:Win32/Upatre.AA,SIGNATURE_TYPE_PEHSTR_EXT,0b 00 09 00 17 00 00 "
		
	strings :
		$a_03_0 = {89 7c 24 2c 80 ?? 4d 75 ?? 80 ?? 01 5a 0f 84 ?? ?? ?? ?? 8b 44 24 10 8b 14 ?? ?? ?? ?? ?? 33 c0 8b cf 40 c1 e9 02 3b c8 76 ?? 31 ?? ?? 40 } //10
		$a_01_1 = {03 f7 8b 06 33 c2 89 06 42 49 75 } //10
		$a_01_2 = {03 f2 8b 06 33 c7 89 06 47 49 75 } //10
		$a_01_3 = {8a cc 8b 45 e8 8b 14 88 6a 04 5f 8b 4d 04 c1 e9 02 49 8b 75 00 03 f7 31 16 42 e2 f9 } //8
		$a_03_4 = {8b 00 66 3d 4d 5a 0f 84 ?? ?? ?? ?? 8b 45 b4 c1 e0 02 89 45 a8 } //10
		$a_03_5 = {8b 07 66 3d 4d 5a 74 ?? 8b 45 88 8b c8 8b 95 ?? ?? ?? ?? c1 e0 02 03 d0 8b 02 } //10
		$a_01_6 = {80 3b 4d 8b f8 75 12 80 7b 01 5a 75 0c ff 75 fc 53 57 e8 } //10
		$a_03_7 = {89 74 24 20 80 ?? 5a 0f 85 ?? ?? ?? ?? 80 ?? 01 5a 0f 85 ?? ?? ?? ?? 80 ?? 02 50 0f 85 ?? ?? ?? ?? 80 ?? 03 00 0f 85 ?? ?? ?? ?? 8b 54 24 28 33 c0 8b 14 ?? ?? ?? ?? ?? 8b ce c1 e9 02 40 3b c8 76 08 31 ?? ?? 40 } //10
		$a_01_8 = {8b 55 e4 0f b7 42 3c 03 d0 0f b7 4a 06 83 c2 14 0f b7 02 } //10
		$a_01_9 = {89 45 04 89 45 44 8b 45 00 66 81 38 4d 5a } //10
		$a_01_10 = {89 45 c0 89 45 e0 8b 45 bc 8b 00 66 3d 4d 5a } //8
		$a_01_11 = {00 00 33 c0 39 44 24 0c 76 15 8b 4c 24 08 8a 0c 08 8b 54 24 04 88 0c 10 40 3b 44 24 0c 72 eb } //3
		$a_80_12 = {00 61 70 70 6c 69 63 61 74 69 6f 6e 2f 2a 00 } //  1
		$a_80_13 = {00 74 65 78 74 2f 2a 00 } //  1
		$a_80_14 = {2e 72 61 72 00 } //.rar  1
		$a_80_15 = {2e 65 6e 63 00 } //.enc  1
		$a_80_16 = {2e 64 61 74 00 } //.dat  1
		$a_80_17 = {2e 7a 69 70 00 } //.zip  1
		$a_80_18 = {2e 63 6c 6c 00 } //.cll  1
		$a_80_19 = {2e 70 64 66 00 } //.pdf  1
		$a_12_20 = {3a 5c 54 45 4d 50 5c 90 02 06 2e 65 78 65 90 00 01 } //2
	condition:
		((#a_03_0  & 1)*10+(#a_01_1  & 1)*10+(#a_01_2  & 1)*10+(#a_01_3  & 1)*8+(#a_03_4  & 1)*10+(#a_03_5  & 1)*10+(#a_01_6  & 1)*10+(#a_03_7  & 1)*10+(#a_01_8  & 1)*10+(#a_01_9  & 1)*10+(#a_01_10  & 1)*8+(#a_01_11  & 1)*3+(#a_80_12  & 1)*1+(#a_80_13  & 1)*1+(#a_80_14  & 1)*1+(#a_80_15  & 1)*1+(#a_80_16  & 1)*1+(#a_80_17  & 1)*1+(#a_80_18  & 1)*1+(#a_80_19  & 1)*1+(#a_12_20  & 1)*2) >=9
 
}